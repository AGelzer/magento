<form class="getresponse" method="post" name="getresponseexport"
      action="<?php echo Mage::helper("adminhtml")->getUrl('getresponse/export/run'); ?>">

    <ul class="messages">
        <li class="notice-msg">
            <ul>
                <li>
                    <span>Export your customer information from Magento to your GetResponse account.<br />Use this option for one time export of your existing customers.</span>
                </li>
            </ul>
        </li>
    </ul>

	<div class="content-header">
		<h3>Export Customer Data on Demand</h3>
        <p class="form-buttons">
            <button onclick="setLocation('<?php echo Mage::helper("adminhtml")->getUrl("getresponse/list/index")."?back_url=".base64_encode('getresponse/export/index'); ?>')" type="button" name="Submit" class="scalable add"><span>Add New Contact List</span></button>
            <button id="gr_export" type="submit" onclick="getresponseexport.submit();" name="Submit"><span>Export</span></button>
        </p>
	</div>

    <div class="entry-edit">

        <div class="entry-edit-head">
            <h4 class="icon-head head-edit-form fieldset-legend">Export</h4>
        </div>

        <div class="fieldset fieldset-wide">
            <div class="hor-scroll">

                <table cellspacing="0" class="form-list">
                    <tbody>
                    <tr>
                        <td class="label"><label for="api_key">Contact list <span class="required">*</span></span></label></td>
                        <td class="value">
                            <?php if ( !empty($campaigns)) :?>
                                <select name="campaign_id" id="campaign_id">
                                    <option value="">Select a list</option>
                                    <?php foreach ($campaigns as $id => $name) : ?>
                                    <?php echo '<option value="' . $id . '">' . $name . '</option>'; ?>
                                    <?php endforeach; ?>
                                </select>
                            <?php else: ?>
                                <span class="error">An error occurred while trying to get campaigns.</span>
                                <?php endif ?>
                        </td>
                    </tr>

                    <tr class="empty-space details">
                        <td colspan="2"></td>
                    </tr>

                    <?=$autoresponder_block?>

                    <tr class="empty-space details">
                        <td colspan="2"></td>
                    </tr>

                    <tr>
                        <td class="label">Ecommerce data</td>
                        <td class="value">
                            <input type="checkbox" name="gr_export_ecommerce_details" id="gr_export_ecommerce_details" value="1"/>
                            <label for="gr_export_ecommerce_details">Include ecommerce data in this export</label>
                        </td>
                    </tr>

                    <tr id="ecommerce_store" style="display: none;">
                        <td class="label">Store</td>
                        <td class="value">
                            <select name="ecommerce_store" id="ecommerce_store">
                                <option value="">Select a store</option>
                                <?php foreach ($gr_shops as $shop):?>
                                    <option value="<?php echo $shop['shopId'] ?>">
                                        <?php echo $shop['name'] ?>
                                    </option>';
                                <?php endforeach ?>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td class="label">Performance optimization</td>
                        <td class="value">
                            <input type="checkbox" name="gr_export_schedule" id="gr_export_schedule" value="1"/>
                            <label for="gr_export_schedule">Use a time-based job scheduler for this export</label>
                            <br />
                            <p class="note">To use this option, you need to have crontab access and root-level (administrative) access to the server. For help with running scheduled events, please contact our
                                <a href="https://www.getresponse.com/features/support">Support Team</a></p>
                        </td>
                    </tr>

                    <tr>
                        <td class="label">Contact info</td>
                        <td class="value">
                            <input type="checkbox" name="gr_sync_order_data" id="gr_sync_order_data" value="1"/>
                            <label for="gr_sync_order_data">Update contact info</label>
                            <p class="note">Select this option if you want to overwrite contact details that already exist in your GetResponse database.<br />
Clear this option to keep existing data intact</p>
                        </td>
                    </tr>

                    </tbody>
                </table>

            </div>
        </div>

		<div id="customNameFields" style="display: none;">

            <div class="entry-edit">

                <div class="entry-edit-head">
                    <h4 style="margin-top: 3px" class="icon-head head-edit-form fieldset-legend">Update contact info</h4>
                    <p class="form-buttons">
                        <button type="button" class="add-new-mapping add" name="Submit"><span>Add New Mapping</span></button>
                    </p>
                </div>

                <div class="fieldset fieldset-wide fieldset-wide-no-padding">
                    <div class="grid">
                        <div class="hor-scroll">

                            <table cellspacing="0" class="data customs-table">
                                <colgroup>
                                    <col width="600">
                                    <col width="800">
                                </colgroup>
                                <thead>
                                <tr class="headings">
                                    <th class="no-link"><span class="nobr">Customer details</span></th>
                                    <th class="no-link"><span class="nobr">Custom fields in GetResponse</span></th>
                                    <th class="no-link last"><span class="nobr">Action</span></th>
                                </tr>
                                </thead>

                                <tbody>
                                <tr class="even">
                                    <td>
                                        <select disabled name="firstname">
                                            <option value="firstname">firstname</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input class="input-text disabled" type="text" name="firstname" value="firstname" disabled />
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>
                                        <select disabled name="lastname">
                                            <option value="lastname">lastname</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input class="input-text disabled" type="text" name="lastname" value="lastname" disabled />
                                    </td>
                                    <td></td>
                                </tr>
                                <tr class="even">
                                    <td>
                                        <select disabled name="email">
                                            <option value="email">email</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input class="input-text disabled" type="text" name="email" value="email" disabled />
                                    </td>
                                    <td></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <p class="note customs-note">
                    You can use lowercase English alphabet characters, numbers, and underscore ("_"). Maximum 32 characters.
                </p>
            </div>
        </div>
		<input name="form_key" type="hidden" value="<?php echo Mage::getSingleton('core/session')->getFormKey(); ?>"/>
    </div>
</form>

<script>

    var customs = <?php echo $customs['customs']; ?>;
    var custom_values = <?php echo $customs['custom_values']; ?>;

    jQuery('.add-new-mapping').on('click', function() {
        GetresponseMapping(customs, custom_values);
        return false;
    });

    var ecommerce = jQuery('#gr_export_ecommerce_details'), ecommerce_store = jQuery('#ecommerce_store');
    if (ecommerce.prop('checked') === true) {
        ecommerce.show();
    }

    ecommerce.on('click', function() {
        ecommerce_store.toggle('slow');
    });

    var sod = jQuery('#gr_sync_order_data'), cfp = jQuery('#customNameFields');
    if (sod.prop('checked') === true) {
        cfp.show();
    }

    function switchHandler() {
        jQuery('#gr_sync_order_data').on("click", function () {
            cfp.toggle('slow');
        });
    }
    switchHandler();

</script>